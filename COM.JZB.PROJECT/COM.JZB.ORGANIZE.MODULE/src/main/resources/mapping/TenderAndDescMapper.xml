<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jzb.org.dao.TenderAndDescMapper">
<!--查询招标-->
    <select id="queryTenderMessage" resultType="Map">
        select * from tb_project_tendering_list  WHERE
        status = '1' order by updtime desc LIMIT #{pagesize} OFFSET #{start}
    </select>
<!--查询最大招标-->
    <select id="queryTenderMessageCount" resultType="int">
         select count(1) from tb_project_tendering_list  WHERE
        status = '1'
    </select>
<!--查询全部-->
    <select id="queryAllTenderAndDescMessage" resultType="Map">
        select id,tendid,title, ( SELECT cname FROM tb_project_type WHERE typeid = A.projecttype ) projecttype, ( SELECT cname FROM tb_tendering_judge   WHERE typeid = 666 ) AS evaluation,type,provice,city,opendate from tb_tendering_result_list A
        union
        select id,tendid,title,( SELECT cname FROM tb_project_type WHERE typeid = B.projecttype ) projecttype,( SELECT cname FROM tb_tendering_judge   WHERE typeid = B.evaluation )  evaluation,type,provice,city,opendate from tb_project_tendering_list B
        order by opendate
        LIMIT #{pagesize} OFFSET #{start}
    </select>
<!--插入招标信息-->
    <insert id="addTenderMessage">
        insert into tb_project_tendering_list(tendid,projecttype,certificate,noticetype,title,opendate,type,source,provice,city,evaluation,pbmode,snatchid,idx,adduid,addtime,upduid,updtime,status,summary)
         values (
         #{tendid},#{projecttype},#{certificate},#{noticetype},#{title},#{opendate},#{type},#{source},#{provice},#{city},#{evaluation},#{pbmode},#{snatchid}, (select count(1)+1 from tb_project_tendering_list WHERE status = '1'),#{adduid},#{addtime},#{adduid},#{addtime},#{status},#{summary}
         )
    </insert>
<!--插入招标详情信息-->
    <insert id="addTenderInfoMessage">
         insert into tb_project_tendering_info (tendid,projecttype,certificate,noticetype,title,opendate,type,infourl,projdq,source,provice,city,pbmode,content,snatchid,adduid,addtime,upduid,updtime,status,summary)
         values (#{tendid},#{projecttype},#{certificate},#{noticetype},#{title},#{opendate},#{type},
         #{infourl},#{projdq},#{source},#{provice},#{city},#{pbmode},#{content},#{snatchid},#{adduid},#{addtime},
         #{adduid},#{addtime},#{status},#{summary} )
    </insert>

    <update id="putTenderInfoMessage">
        update tb_project_tendering_info
        <set>
            <if test="projecttype!=null">
                projecttype=#{projecttype},
            </if>
            <if test="certificate!=null">
                certificate=#{certificate},
            </if>
            <if test="title!=null">
                title=#{title},
            </if>
            <if test="infourl!=null">
                infourl=#{infourl},
            </if>
            <if test="provice!=null">
                source=#{provice},provice=#{provice},
            </if>
            <if test="city!=null">
                city=#{city},
            </if>
            <if test="content!=null">
                content=#{content},
            </if>
            <if test="upduid!=null">
                upduid=#{upduid},
            </if>
            <if test="projecttype!=null">
                updtime=#{updtime},
            </if>
        </set>
        where tendid = #{tendid}
    </update>
    <update id="putTenderMessage">
        update tb_project_tendering_list
        <set>
            <if test="projecttype!=null">
                projecttype=#{projecttype},
            </if>
            <if test="certificate!=null">
                certificate=#{certificate},
            </if>
            <if test="title!=null">
                title=#{title},
            </if>
            <if test="provice!=null">
                source=#{provice},provice=#{provice},
            </if>
            <if test="city!=null">
                city=#{city},
            </if>
            <if test="evaluation!=null">
                evaluation=#{evaluation},
            </if>
            <if test="upduid!=null">
                upduid=#{upduid},
            </if>
            <if test="updtime!=null">
                updtime=#{updtime},
            </if>

        </set>
        where tendid = #{tendid}
    </update>

    <delete id="delTenderMessage">
        delete from tb_project_tendering_list where tendid = #{tendid}
    </delete>

    <delete id="delTenderInfoMessage">
        delete from tb_project_tendering_info where tendid = #{tendid}
    </delete>

</mapper>
