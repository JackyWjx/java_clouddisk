<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jzb.org.dao.TbContractStatisticsMapper">

    <!-- 查找合同统计信息 -->
    <select id="findContractStatisticsList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        staid,
        conid,
        conname,
        sales,
        ownid,
        ( SELECT cname FROM tb_company_list WHERE cid = tcsl.ownid ) ownname,
        region,
        proname,
        projid,
        ( SELECT projectname FROM tb_company_project WHERE projectid = tcsl.projid ) projectname,
        concname,
        conperiod,
        amount,
        invoicemoney,
        returnmoney,
        collectmoney,
        signdate,
        subcname,
        conimportant,
        contype,
        yntable,
        condesc
        FROM
        tb_contract_statistics_list tcsl
        WHERE
        status = '1'
        <if test="beginTime!=null and beginTime !=''">
            and signdate &gt; #{beginTime}
        </if>
        <if test="endTime!=null and endTime !=''">
            and signdate &lt; #{endTime}
        </if>
        <if test="page!=null and page!=''">
            limit #{pagesize} offset #{pageno}
        </if>
    </select>

    <!-- 查询总数 -->
    <select id="findContractCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT
        count(1)
        FROM
        tb_contract_statistics_list
        WHERE
        status = '1'
        <if test="beginTime!=null and beginTime !=''">
            and signdate &lt; #{beginTime}
        </if>
        <if test="endTime!=null and endTime !=''">
            and signdate &gt; #{endTime}
        </if>
    </select>

    <!-- 修改合同统计信息 -->
    <update id="updateContractStatisticsList" parameterType="java.util.Map">
        update tb_contract_statistics_list
        <trim prefix="set" suffixOverrides="," suffix="where staid=#{staid}">
            <if test="contid != null and contid!=''">contid=#{contid} ,</if>
            <if test="conname != null and conname!=''">conname=#{conname} ,</if>
            <if test="sales != null and sales!=''">sales=#{sales} ,</if>
            <if test="ownid != null and ownid!=''">ownid=#{ownid} ,</if>
            <if test="region != null and region!=''">region=#{region} ,</if>
            <if test="proname != null and proname!=''">proname=#{proname} ,</if>
            <if test="projid != null and projid!=''">projid=#{projid} ,</if>
            <if test="concname != null and concname!=''">concname=#{concname} ,</if>
            <if test="conperiod != null and conperiod!=''">conperiod=#{conperiod} ,</if>
            <if test="amount != null and amount!=''">amount=#{amount} ,</if>
            <if test="invoicemoney != null and invoicemoney!=''">invoicemoney=#{invoicemoney} ,</if>
            <if test="returnmoney != null and returnmoney!=''">returnmoney=#{returnmoney} ,</if>
            <if test="collectmoney != null and collectmoney!=''">collectmoney=#{collectmoney} ,</if>
            <if test="signdate != null and signdate!=''">signdate=#{signdate} ,</if>
            <if test="subcname != null and subcname!=''">subcname=#{subcname} ,</if>
            <if test="conimportant != null and conimportant!=''">conimportant=#{conimportant} ,</if>
            <if test="contype != null and contype!=''">contype=#{contype} ,</if>
            <if test="yntable != null and yntable!=''">yntable=#{yntable} ,</if>
            <if test="condesc != null and condesc!=''">condesc=#{condesc} ,</if>
            <if test="upuid != null and upuid!=''">upuid=#{upuid} ,</if>
            <if test="updtime != null and updtime!=''">updtime=#{updtime} ,</if>
        </trim>
    </update>

    <!-- 设置删除状态 -->
    <update id="setDeleteStatus" parameterType="java.util.Map">
        update tb_contract_statistics_list set status='2',upduid=#{upduid},updtime=#{updtime} where staid=#{staid}
    </update>

</mapper>